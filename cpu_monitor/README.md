# CPU 监控器

CPU 监控器是一个用于监控指定 CPU 及其超线程组的利用率和进程信息的 Shell 脚本工具。

## 功能特性

- 监控指定 CPU 及其超线程组的利用率
- 显示系统中高 CPU 使用率的进程信息
- 支持自定义监控间隔
- 支持输出到标准输出或日志文件
- 自动识别 CPU 拓扑结构和超线程关系
- 纯 Shell 实现，无需额外依赖

## 系统要求

- Linux 系统
- Bash 4.0 或更高版本
- 标准 Linux 工具：`ps`, `grep`, `awk`, `free`, `uptime`, `nproc`

## 使用方法

### 基本用法

```bash
# 监控 CPU 0,1,2，每 5 秒统计一次
./cpu_monitor.sh -c 0,1,2 -i 5

# 监控 CPU 0-3 和 8-11，每 10 秒统计一次，输出到日志文件
./cpu_monitor.sh -c 0-3,8-11 -i 10 -l

# 监控 CPU 0,2,4,6，每 2 秒统计一次，输出到指定日志文件
./cpu_monitor.sh -c 0,2,4,6 -i 2 --log-file cpu_monitor.log
```

### 参数说明

- `-c, --cpus`: 要监控的 CPU 列表（必需）
  - 支持单个 CPU: `0`
  - 支持多个 CPU: `0,1,2`
  - 支持范围: `0-3` (表示 0,1,2,3)
  - 支持混合: `0-3,8-11,16`

- `-i, --interval`: 监控间隔（秒），默认 5 秒

- `-l, --log`: 输出到日志文件，文件名为启动时间戳

- `--log-file`: 指定日志文件路径

### 输出格式

监控器会显示以下信息：

1. **CPU 利用率**: 每个被监控 CPU 的实时利用率
2. **超线程组信息**: 显示目标 CPU 及其超线程兄弟 CPU
3. **进程信息**: 显示运行在这些 CPU 上的主要进程
4. **系统信息**: 总体 CPU 使用率、内存使用率、负载平均值

### 示例输出

```
===============================================================================
CPU 监控报告 - 2024-01-15 14:30:25
===============================================================================

目标 CPU 0 及其超线程组: [0, 4]
------------------------------------------------------------
CPU  0:  15.50%
    主要进程:
      PID   1234: python              CPU:  8.5% MEM:  2.1%
      PID   5678: firefox             CPU:  4.2% MEM: 15.8%

CPU  4:   8.30%
    主要进程:
      PID   9012: chrome              CPU:  3.1% MEM:  8.4%

系统整体信息:
----------------------------------------
总 CPU 使用率:  12.45%
内存使用率:  68.23%
负载平均: 1.25 1.18 1.05
```

## 注意事项

1. 脚本需要读取 `/sys/devices/system/cpu/` 目录来获取 CPU 拓扑信息
2. 监控进程信息可能需要适当的权限
3. 使用 Ctrl+C 可以安全地停止监控
4. 日志文件会在程序结束时自动关闭

## 故障排除

如果遇到权限问题，可以尝试：
```bash
sudo python cpu_monitor.py -c 0,1 -i 5
```

如果无法识别超线程拓扑，脚本会回退到只监控指定的 CPU。 